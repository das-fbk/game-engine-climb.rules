package eu.trentorise.game.model

import eu.trentorise.game.notification.BadgeNotification;

global String const_school_name;
global Double const_class_size;

rule "class mode count"
salience -1000
when
	Player($teamId : id, $teamId != const_school_name, team == true)
	//$ts : TeamState($members : members)
	$part : PointConcept(name == "participation_count")
	$absent: PointConcept(name == "absence_count")
	$zst : PointConcept(name == "zeroImpact_solo_trips")
	$zat : PointConcept(name == "zeroImpact_wAdult_trips")
	$pt : PointConcept(name == "pedibus_trips")
then
	Double validTrips = $zst.getPeriodCurrentScore("daily") 
		+ $zat.getPeriodCurrentScore("daily")
		+ $pt.getPeriodCurrentScore("daily");
        Double present = const_class_size - $absent.getPeriodCurrentScore("daily");
	Double todayParticipation = $part.getPeriodCurrentScore("daily");	
	log("apply \' class mode count \' to class: " + (String)$teamId 
    		+ " with participation = " + todayParticipation 
    		+ " and size = " + const_class_size);
        log ("---> " + (todayParticipation.equals(const_class_size)));
	// only if I have received an action for each student today
	if( todayParticipation.equals(const_class_size) ) {
                 log("received all actions and valid = " + validTrips);
		if (validTrips >= 0.75 * present) {
				log("BRAVI classe: " + $teamId + " - Oggi avete raggiunto obiettivo di viaggi eco-sostenibili!");
			}
	}
end
